<tal:master define="level options/level|python:0;
                    children options/children | nothing;
                    bottomLevel options/bottomLevel | nothing;"
            i18n:domain="g24.basetype">

<metal:main define-macro="threadview_main">
  <tal:navitem repeat="node children">
    <tal:item define="children node/children;
                      item node/item;
                      obj item/getObject;
                      heading_level python:level + 1;
                      base_url item/getURL"
              condition="python:bottomLevel &lt;= 0 or level &lt;= bottomLevel">

<li class=""
  tal:attributes="class string:threadview-level-${level}">

  <article class="element" id="" tal:attributes="id item/UID">
    <header>
      <h1>
        <a href="" tal:attributes="href string:${base_url}/thread" tal:content="item/Title">Title</a>
      </h1>
    </header>
    <p tal:content="structure obj/text/output|nothing">Text</p>
    <footer>
      <a href="" tal:attributes="href string:${base_url}/stream?user=${item/Creator}" tal:content="item/Creator">Creator</a><br/>
      <tal:tags repeat="tag item/Subject">
        <a href="" tal:attributes="href string:${base_url}/stream?tag=${tag}" tal:content="tag">Tag</a><br/>
      </tal:tags>
      <em tal:content="item/created"/><br/>
      <a class="sharingbox_edit" tal:condition="python:view.can_edit(obj)" href="" tal:attributes="href string:${base_url}/@@sharingbox_edit">Edit</a> |
      <a class="ctrl sharingbox_add" tal:condition="python:view.can_add(obj)" href="" tal:attributes="href string:${base_url}/@@sharingbox_add">Add</a><br/>
    </footer>
  </article>

  <ul
    class="threadview"
    tal:define="subthread python:view.recurse(children=children, level=level+1, bottomLevel=bottomLevel)"
    tal:condition="children"
    tal:content="structure subthread" />

</li>

    </tal:item>
  </tal:navitem>
</metal:main>
</tal:master>
