<article class="element" id=""
    tal:define="base_url context/absolute_url; data nocall:view/data"
    tal:attributes="id view/uuid">
  <header>
    <h1>
      <a href="" tal:attributes="href string:${base_url}/thread" tal:content="data/title">Title</a>
    </h1>
  </header>
  <p tal:content="structure data/text|nothing">Text</p>

  <div tal:condition="data/is_event" class="eventDetails">
    <table class="vertical listing" summary="Event details">
      <tbody>
        <tr>
          <th i18n:translate="event_when">When</th>
          <td>
            <tal:date replace="python:view.format_event_dates(data.start,
                                                              data.end)"/>

            <div tal:define="occs view/occurrences;
                             occs python:occs and occs[1:] or None"
                 tal:condition="occs">
              <tal:occurrences i18n:translate="">More occurrences of this event:</tal:occurrences>
              <ul>
                <li tal:repeat="occ occs">
                  <tal:date replace="python:view.format_event_dates(occ[0], occ[1])"/>
                </li>
              </ul>
            </div>
          </td>
        </tr>
        <tr tal:condition="data/location">
          <th i18n:translate="event_when">Where</th>
          <td tal:content="data/location"></td>
        </tr>
        <tr>
          <th i18n:translate="heading_add_to_calendar">Add event to calendar</th>
          <td tal:define="here_url context/@@plone_context_state/object_url;
                          portal context/@@plone_portal_state/portal;">
            <a href="#"
                tal:attributes="href string:$here_url/ics_view"
                title="Download this event in iCal format"
                i18n:attributes="title title_add_to_ical;">
              <img tal:replace="structure portal/icon_export_ical.png" src="" alt="" />
              <span i18n:translate="label_add_to_ical">iCal</span>
            </a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <footer>
    <tal:tags repeat="tag data/subjects">
      <tal:label condition="repeat/tag/start"><strong>Tags:</strong></tal:label>
      <tal:sep condition="not: repeat/tag/start">|</tal:sep>
      <a href="" tal:attributes="href string:${base_url}/stream?tag=${tag}" tal:content="tag">Tag</a>
      <tal:brk condition="repeat/tag/end"><br/></tal:brk>
    </tal:tags>
    <strong>Created by:</strong> <a href="" tal:attributes="href string:${base_url}/stream?user=${context/Creator}" tal:content="context/Creator">Creator</a><br/>
    <strong>Created on:</strong> <em tal:content="context/created"/><br/>
    <ul class="element-controls" tal:define="can_edit view/can_edit; can_add view/can_add" tal:condition="can_edit|can_add">
      <li><a class="sharingbox_edit" tal:condition="can_edit" href="" tal:attributes="href string:${base_url}/@@sharingbox_edit">Edit</a></li>
      <li><a class="ctrl sharingbox_add" tal:condition="can_add" href="" tal:attributes="href string:${base_url}/@@sharingbox_add">Add</a></li>
    </ul>
  </footer>
</article>
